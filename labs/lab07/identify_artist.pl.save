#!/usr/bin/perl


# init hashmaps
my %artistFiles;
my %totalWords;
foreach $file (glob "lyrics/*.txt") {
	open F, "$file" or die;
	while ($line = <F>) {
		chomp $line;
                $line = lc $line;
                @words = grep(/./, split(/[^a-zA-Z]/, $line));
                # loop through each line and check for the word
               	foreach $i (@words) {
			# bag of words
                	if (!$artistFiles{$file}{$i}) {
				$artistFiles{$file}{$i} = 1;
			} else {
				$artistFiles{$file}{$i}++;
			}
			# total words hash
			if (!$totalWords{$file}) {
				$totalWords{$file} = 1;
			} else {
				$totalWords{$file}++;
			}
        	}
	}
}


# set the log prob of each artist into a hashmap
sub logProb {
	my ($find) = @_;
	foreach $file (glob "lyrics/*.txt") {	
		$cw = $artistFiles{$file}{$find};
		$ncw = $cw + 1;
		$tw = $totalWords{$file};
		$fq = log($ncw/$tw);
		# get artist name
		@fn = split("/", $file);
		@ufn = split(".txt", @fn[1]);
		$artist = @ufn[0];
		$artist =~ s/_/ /g;

		$prob{$artist} = $fq;
	}
	return %prob;
}


sub getSongWords {
	my ($file) = @_;
	my %songWords;
	open F, $file or die;
	while ($line = <F>) {
                chomp $line;
                $line = lc $line;
                @words = grep(/./, split(/[^a-zA-Z]/, $line));
                # loop through each line and check for the word
                foreach $i (@words) {
			if (!$songWords{$i}) {
				$songWords{$i} = 1;
			} else {
				$songWords{$i}++;
			}
         	}
	}
	
	return %songWords;
}


my %singer;
for my $arg (@ARGV) {
	my %songWords = getSongWords($arg);

	foreach my $word (keys %songWords) {
		my %wordProb = logProb($word);
		# expand log prob and get artists
		foreach my $artist (keys %wordProb) {
			$singer{$artist} += $wordProb{$artist} * $songWords{$word};
		}
	}

	my $mN = "Adele"; my $mV = $singer{"Adele"};   
	foreach my $sign (keys %singer) {
		if ($mV < $singer{$sign}) {
			$mV = $singer{$sign};
			$mN = $sign;
		}
#		printf("$sign %4.1f\n", $singer{$sign})
	}
	$singer{$sign}

}










for my $arg (@ARGV) {
	open F, $arg or die;
	while ($line = <F>) {
                chomp $line;
                $line = lc $line;
                @words = grep(/./, split(/[^a-zA-Z]/, $line));
                # loop through each line and check for the word
                foreach $i (@words) {
			if (!$songwords{$arg}{$i}) {
				$songwords{$arg}{$i} = 1;
			} else {
				$songwords{$arg}{$i}++;
			}
        	}
	}

}


foreach my $song (keys %songwords) {
	
	foreach my $word (keys $songwords{$song}) {
		%prob = logProb($word);
		foreach my $artist (keys %prob) {
			$person{$artist} += $prob{$artist} * $songwords{$song}{$word};
		}
	}
	$maxV = 0;
	$maxN = "Adele";
        foreach my $per (keys %person) {
		$val = $person{$per};
		
		if ($maxV == 0) {
			$maxV = $val;
		} elsif ($maxV < $val) {
			$maxV = $val;
			$maxN = $per;
		}
        }	
#	printf("%s most resembles the work of %s (log-probability=%6.1f)\n", $song, $maxN, scalar $maxV);
}
